<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WhatsApp Baileys</title>

<style>
body { font-family:Arial; background:#0d6efd; color:#fff; margin:0 }
header {
  padding:10px;
  background:#084298;
  display:flex;
  justify-content:space-between;
}
.menu { cursor:pointer; display:none }
.panel {
  position:fixed; top:50px; right:10px;
  background:#fff; color:#000;
  padding:10px; border-radius:8px;
  display:none;
}
.container { padding:15px; max-width:420px; margin:auto }
input, button, textarea {
  width:100%; padding:12px; margin-top:8px;
  border-radius:8px; border:none
}
button { background:#ffc107 }
.box { background:#fff; color:#000; padding:10px; border-radius:8px; margin-top:10px }
#logs { max-height:200px; overflow:auto; font-size:13px }
</style>
</head>

<body>

<header>
  <span>WhatsApp</span>
  <span class="menu" id="menuBtn">☰</span>
</header>

<div class="panel" id="msgPanel">
  <input id="msgPhone" placeholder="Número">
  <textarea id="msgText" placeholder="Mensagem"></textarea>
  <button onclick="sendMessage()">Enviar</button>
</div>

<div class="container">
<input id="session" placeholder="Nome da sessão">
<button onclick="start()">Iniciar</button>

<div id="phoneBox" class="box" style="display:none">
  <input id="phone" placeholder="Número">
  <button onclick="sendPhone()">Enviar número</button>
</div>

<div id="codeBox" class="box" style="display:none"></div>
<div id="infoBox" class="box" style="display:none"></div>
<div id="logs" class="box"></div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io()
let currentSession = ''

function log(msg){
  logs.innerHTML += msg + '<br>'
  logs.scrollTop = logs.scrollHeight
}

function start(){
  currentSession = session.value
  socket.emit('start-session', currentSession)
}

function sendPhone(){
  socket.emit('send-phone', { phone: phone.value })
}

function sendMessage(){
  socket.emit('send-message',{
    phone: msgPhone.value,
    message: msgText.value
  })
}

menuBtn.onclick = () =>
  msgPanel.style.display =
    msgPanel.style.display === 'block' ? 'none' : 'block'

socket.on('log', log)

socket.on('request-phone', ()=> phoneBox.style.display='block')

socket.on('pairing-code', d=>{
  codeBox.style.display='block'
  codeBox.innerHTML = `<h3>${d.code}</h3>`
})

socket.on('session-ready', d=>{
  menuBtn.style.display='block'
  infoBox.style.display='block'
  infoBox.innerHTML = `
    <b>${d.name}</b><br>
    ${d.number}<br>
    <a href="${d.downloadUrl}">⬇️ Baixar ZIP</a>
    <hr>
    ${d.groups.map(g=>`${g.name} (${g.members})`).join('<br>')}
  `
})
</script>

</body>
</html>
