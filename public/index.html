<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WhatsApp Session Manager</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#4facfe,#00f2fe);
  padding: 15px;
  color: #fff;
}
.container {
  max-width: 420px;
  margin: auto;
  text-align: center;
}
input, button {
  width: 100%;
  padding: 14px;
  margin-top: 10px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
}
button {
  background: #ff9800;
  color: #fff;
  cursor: pointer;
}
button:disabled {
  background: #999;
}
.box {
  background: #fff;
  color: #000;
  margin-top: 15px;
  padding: 12px;
  border-radius: 10px;
  display: none;
  text-align: left;
}
#logs {
  max-height: 200px;
  overflow: auto;
  font-size: 13px;
}
.code {
  font-size: 26px;
  text-align: center;
  font-weight: bold;
  letter-spacing: 4px;
}
.group {
  font-size: 14px;
  margin-bottom: 5px;
}
.download {
  display: block;
  margin-top: 10px;
  background: #28a745;
  color: #fff;
  text-align: center;
  padding: 10px;
  border-radius: 6px;
  text-decoration: none;
}
</style>
</head>

<body>

<div class="container">
  <h2>WhatsApp Session</h2>

  <!-- Sess√£o -->
  <input id="sessionName" placeholder="Nome da sess√£o">

  <!-- N√∫mero -->
  <input id="phone" placeholder="N√∫mero com DDI (ex: +5511999999999)">

  <button id="startBtn" onclick="start()">Iniciar Sess√£o</button>

  <div id="status">Aguardando...</div>

  <!-- C√≥digo -->
  <div id="codeBox" class="box">
    <h3>C√≥digo de Conex√£o</h3>
    <div class="code" id="pairCode">----</div>
    <p>Digite este c√≥digo no WhatsApp</p>
  </div>

  <!-- Info -->
  <div id="infoBox" class="box">
    <h3>Informa√ß√µes da Conta</h3>
    <div id="accountInfo"></div>
    <h4>Grupos</h4>
    <div id="groups"></div>
    <a id="downloadLink" class="download" href="#" target="_blank">‚¨áÔ∏è Baixar ZIP</a>
  </div>

  <!-- Logs -->
  <div id="logs" class="box"></div>
</div>

<script src="/socket.io/socket.io.js"></script>

<script>
const socket = io({
  transports: ['websocket']
});

const statusEl = document.getElementById('status');
const logsEl = document.getElementById('logs');
const codeBox = document.getElementById('codeBox');
const pairCodeEl = document.getElementById('pairCode');
const infoBox = document.getElementById('infoBox');
const accountInfoEl = document.getElementById('accountInfo');
const groupsEl = document.getElementById('groups');
const downloadLink = document.getElementById('downloadLink');
const startBtn = document.getElementById('startBtn');

function log(msg) {
  const d = document.createElement('div');
  d.textContent = msg;
  logsEl.appendChild(d);
  logsEl.scrollTop = logsEl.scrollHeight;
  logsEl.style.display = 'block';
}

function start() {
  const session = document.getElementById('sessionName').value.trim();
  const phone = document.getElementById('phone').value.trim();

  if (!session || !phone) {
    alert('Informe o nome da sess√£o e o n√∫mero');
    return;
  }

  startBtn.disabled = true;
  statusEl.textContent = 'üöÄ Iniciando sess√£o...';

  socket.emit('start-session', { session, phone });
}

socket.on('log', msg => {
  log(msg);
});

socket.on('pairing-code', data => {
  codeBox.style.display = 'block';
  pairCodeEl.textContent = data.code;
  statusEl.textContent = 'üì≤ Digite o c√≥digo no WhatsApp';
});

socket.on('session-ready', data => {
  codeBox.style.display = 'none';
  infoBox.style.display = 'block';

  statusEl.textContent = '‚úÖ Conectado';

  accountInfoEl.innerHTML = `
    <p><b>Nome:</b> ${data.name}</p>
    <p><b>N√∫mero:</b> ${data.number}</p>
  `;

  groupsEl.innerHTML = '';
  data.groups.forEach(g => {
    const div = document.createElement('div');
    div.className = 'group';
    div.textContent = `${g.name} ‚Äî ${g.participants} membros`;
    groupsEl.appendChild(div);
  });

  downloadLink.href = data.downloadUrl;
  startBtn.disabled = false;
});
</script>

</body>
</html>
